# 2021.6.28

## 何东阳

开题报告

SLAM算法实现：

- 雷达仅能实现一定高度的建模，需结合顶部相机全面建模

自主导航实现：

1、使用激光雷达 SLAM 建立的地图为栅格地图

2、白色表示该栅格空间内无障碍物，机器人 可以通行;黑色表示该栅格空间内存在障碍物，机器人不能通行;灰色表示该栅格空间尚未 探索，可通行情况不明。

- 定位
- 路径规划

## 盘卓实

上午：开题报告、尝试连接Kinect，失败

下午：调研了用前端和Qt实现可视化编程的可能性，前者基本不可能，后者找到了一个可以编译，但是不能运行的可视化编程程序[thymio](https://github.com/aseba-community/thymio-vpl2/tree/master/thymio-vpl2)。因此决定调整顺序，先实现学长功能和参观导引功能，再尝试做机械臂，VPL最后再做。

晚上：看了一下学长的代码，发现学长自己写的代码基本都在wpb_home_apps这个文件夹了。明天再仔细研究。以及又试了一下用虚拟机连Kinect，定位了问题所在。

- Set up udev rules for device access: `sudo cp ../platform/linux/udev/90-kinect2.rules /etc/udev/rules.d/`, then replug the Kinect.

![image-20210628204934729](https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/image-20210628204934729.png?raw=true)


USB口连接正常，可以找到Kinect v2。报错一个奇怪的TIME_OUT。

## 魏子卜

上午： 开题报告 语音输出部分：遇到连接不上问题，在李晨韬笔记本上可以显示连接。可以尝试换成其他接口。 语音识别部分：遇到USB无法识别的问题，明天在双系统的笔记本上试一试。

下午： 学习一些现有的开源可视化编程的代码。 尝试运行Thymio代码，发现版本方面的问题。 卸载Qt4，装了Qt6。 和pzs讨论后，决定先跳过可视化编程的部分。

晚上： 去科技服务队修理了笔记本声道的问题，明天试试能否识别机器人音频线。 学习学长的报告及启智ros机器人参考文档。 继续学习ros有关的知识。

## 李晨韬

上午：开题报告及试验语音输出部分，并尝试寻找以及学习VPL编程的开源代码

下午： ubuntu虚拟机出现问题，部分功能无法启用。 学习blockly源码，在本机上运行demo并尝试修改

晚上：安装ubuntu双系统，安装qt5，运行程序正常

# 2021.6.29

## 何东阳

### 上午

安装ubuntu虚拟机，配置ROS开发环境

### 下午

- 继续配置开发环境

- 安装qt5的linux版本

- 研究并跑通学长qt代码，研究设计自己的界面，初步摸清**功能需求**。

  - 登陆界面：一个进入按钮和一个退出按钮
  - 模式选择选择页面（可选择）分为VPL模式和自动导游模式
  - VPL界面
  - 自动导游页面

- 创建qt工程，并添加到小组仓库中，完成了所有页面的基本布局，完成部分如下：
  
  <div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202106291.PNG?raw=true" alt="202106291" style="zoom:67%;" /></div>

目前登录窗口有“进入”和“退出”功能，进入下一个窗口，退出结束进程。

<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202106292.PNG?raw=true" alt="202106292" style="zoom:67%;" /></div>

VPL模式暂时未开发；自动导游模式按钮点击后进入自动导游页面。

<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202106293.PNG?raw=true" style="zoom:67%;" /></div>

开始导游按钮点击后进入导游进行时界面，结束导游按钮点击后退出自动导游页面，回到模式选择页面。

<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202106294.PNG?raw=true" alt="202106294" style="zoom:67%;" /></div>

导游进行时页面是机器人在导游过程中显示的页面，用户点击语音播报（未开发）和停止播报按钮选择开始语音控制和停止语音控制。结束导游按钮必须在停止播报按钮点击后才能点击，点击后返回自动导游页面。

主要解决了两个问题：在创建自动导航进行窗口时，我因为太久没使用qt忘记如何添加照片，导致照片迟迟无法显示，经过查阅相关资料我发现是因为我没有在项目中创建照片资源库，创建后图片成功显示；将窗口显示在屏幕中央。

 ## 盘卓实
 - 上午：用第一种方式进行了slam建图，成功
 - 下午：用gmapping方式进行slam建图（这个更准确），由于电池不行，失败。之后研究基于maptool的自主导航。
 - 晚上：基于maptool进行自主导航，失败，失败原因是运行rosrun wp_pkg wp_node时，程序找不到之前设置的导航点，之后按照文档修改~/catkin_ws/src/waterplus_map_tools/launch/add_waypoint.launch，将其中的robot换成用户名。设置之后在roslaunch waterplus_map_tools wpb_home_nav_test.launch自动定位初始点（找导航点的前一步）就失败了。
 明天计划放弃这个方法，转而使用实验8的方法，即手动设置XYZ坐标的方式，进行设置导航点。
 因为担心进度问题，打算以后在一个方法上尝试最多5小时，如果还是没有进展就及时放弃。

 ## 魏子卜
 上午：
 解决了语音输出的问题
 下午：
 解决了语音识别+输出的问题，并且查阅资料，可以进行中文的识别。
 遇到了语音输出时间过短的问题，网上找不到相应资料。
 晚上：
 复习了Qt，准备把语音相关的功能写到Qt里。

## 李晨韬
今天遇到了较多的问题

Problem:

1.Invoking "make -j4 -l4" failed   编译c-make失败 c-make编译c++的规则中不允许换行，而python是可以的，奇奇怪怪的bug

2.Rviz界面出来后无法运行摄像头，报错cannot launch node of type [joint_state_publisher_gui/joint_state_publisher_gui]

解决方法：sudo apt-get install ros-kinetic-joint-state-publisher-gui

3.最令人头疼的报错：[Error] [DepthPacketStreamParser] Packet buffer is NULL 显示我opencl库中有什么没装，但我显然是能按操作手册装的都装了，就是因为没有Nvidia的显卡驱动，opencl始终装不好，曾一度以为这个功能没法进行开放。

解决方法：进入kinetic_bridge.launch文件直接修改启动方式，既然opencl没装好我就用opengl和cpu执行../kinetic_bridge.launch -> "_depth_method:=opengl _reg_method:=cpu"

4.下载完iai-kinetic后要检查如下三组指令
./Protonect gl to test OpenGL support.

./Protonect cl to test OpenCL support.

./Protonect cpu to test CPU support.

5.下载不了Nvidia/CUDA 

收获：跑通了相机检测人脸、物品等四个程序，明白程序如何从摄像头中截取图像，ros中的opencv3是比较好使用的

# 2021.6.30
## 何东阳
### 上午
- 决定了在虚拟机上开发qt程序，有利于数据传输
- 完成了环境的搭建
- 更新了日志格式，如果要在md格式的日志中显示图片，需输入格式  \<div align=center>\<img src="图片网页地址" alt="图片名" style="zoom:67%;" /></div\> 
### 下午
- 继续研发qt程序
  - 导航进行界面添加初始位置调整按钮
  - 制作操控实例，成功调用系统函数
  - 尝试在qt界面中播放视频，成功。
  - 在同学电脑上运行程序显示有个头文件不存在，尝试解决bug，未果，开发新的无视频功能的版本
  - 学习qt的css控件功能，试图做出美观的qt界面，给用户更好的体验。


## 李晨韬
今天问题也比较多，看了许多代码，也debug了很久，在检测与跟随方面有了较大进展

Problem：
1.libGL error: failed to create drawable 

这个不用太关心，应该是电脑配置不太行，没装显卡驱动造成的

2.Error: Cannot launch node of type [rplidar_ros/rplidarNode];can't locate node[rplidarNode]这是今天较难处理的一个bug，反复安装包之后才得以解决

3.Error：[rplidarNode-6] process has died 这是最离奇的一个bug，它提示我输出端口有毛病，但实际上接的线完全没问题。最后把盘哥套在上面的usb转type-c线去掉后能正常运行，实在是太神奇了。

4.map_server could not open yaml file (yaml file exists) 没建图造成的，我之前一直在做摄像头模块，slam建的图还没有传在本机上。

今天收获很多，在跟随与识别上有较大发展，然后早上的时候仔细学习了qt代码中如何用system调用linux终端并输入命令；下午完成了自动跟随项目，解决了很多bug；晚上一直在处理语音控制系统自动拍照的功能，学习了wpb_home_apps目录下的脚本文件编写与对应cpp运行，非常充实的一天。


 ## 盘卓实
 - 上午: 用gmapping建图，成功
 - 下午：由于用maptool设置的导航点，程序无法识别，所有我用maptool设置导航点，生成waypoint.xmp文件，再去waypoint文件里面，找到这个点的xyz坐标，用这种方式设置导航点，成功。只导航一个点可以，但是导航多点时遇到问题“failed to get a plan”。导航还存在一个问题是初始点的设定。比较麻烦。
 - 晚上：用线上的文字-语音转换工具，将实验室介绍转语音，到达实验室时，播放介绍音频，成功。在wzb写的音频识别的基础上，加了一些关键词检测，实现简单的对话。
 
## 魏子卜

上午：
修改sr_node底层的tts.cpp里的全局变量，发现修改的是语音识别的时间，而不是语音输出的时间。在其他的底层文件进行修改，没得到想要的效果。
最后通过较为简单粗暴的方式实现了语音输出（字符串变成声音）的功能。
另外，可以直接播放mp3，经过反复调试，发现使用相对路径有问题，最终使用绝对路径，可以做到播放指定音频。
至此，对于识别出的某些语音关键词（如：519/电力电子/运动控制），可以通过两种方式（机器读出字符串&播放人声mp3）播放指定介绍内容。

下午：
探讨了如何将需要在命令行输入的内容写到Qt中
在Ubuntu中装能用的新版本的Qt，装一些包，使得能播放视频和语音

晚上：
构思了在此机器人平台的基础上添加的内容，涉及部分数电、模电的知识。



# 2021.7.1
## 何东阳

今天主要是研究qt的界面美化，组件自定义以及帮同学们适配他们写好的程序。

添加了进度条功能。

 ## 盘卓实
 - 上午：找到了导航初始点的问题，原来是这个初始点，默认是建图的起点，如果不在起点，需要去界面里用2D pose estimation设定，比较麻烦。所以现在的想法是先到电梯间那里开始建图（在那里做一点标记），这样我们就不用在界面上调整机器人的初始位置，而是用手柄将机器人遥控到那个点，即可开始导航。导航还是存在问题，只能导一个点。
 - 下午：将原本要输入terminal的ros命令，写到system函数里，从而可以用qt界面上的按钮，启动对应的功能（语音识别和自主导航）。对建图之后的图片进行手动处理，消除了噪声，实现了两个点的导航。

## 李晨韬

 - 解决了 wired connection 1 连接问题，当数据线接上后，wifi会自动断开，导致科大讯飞无法正常工作，于是改换网络连接设置，使得该问题得以解决
- 使用QT做了一个简单问询组件，在QT中能够启动脚本，以及利用问询组件来杀死进程。
- 解决了语音控制拍照功能
- 认真学习了scripts的编写，尝试编写语音控制运动脚本，基本阅读了ros开发者所留脚本接口action_manager，看完了比较底层的东西，希望有所突破。
- 实现了跟随定点，以及导航至定点后又返回。

## 魏子卜

- 实验了稳压模块LM2596（DC-DC）以及升压模块的功能，同时使用信号发生器和电池进行实验，证明LM2596带载没有问题，可以带动机械臂。
- 9V的电池不太行，明天换一个12V的电池试一试，在接入负载时需要保持稳定的输出电压。
- 构想了一些可以添加的传感器模块：
- 红外测温模块：使用MLX90614芯片进行红外测温，通过I2C通信将温度数据传给单片机，由串口模块发送给PC机，并通过扬声器输出体温数据


# 2021.7.2
## 何东阳
- 完善了界面逻辑，添加了新窗口，能够提供用户设置地图的功能入口。该窗口一共有三个按钮，分别可以实现建图、手柄导航、目标跟随功能。点击停止按钮停止工作。

<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202107022.PNG?raw=true" style="zoom:67%;" /></div>

<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202107023.PNG?raw=true;"style="zoom:67%;" /></div>


- 添加功能选择栏，使得使用舒适度增加。选择栏可以选择导游模式和定点模式，每种模式都有一个开关按钮。
<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202107021.PNG?raw=true" alt="202106294" style="zoom:67%;" /></div>


- 发现将toolbutton按钮变为toggle按钮后部分性质消失，无法显示按钮上的文字等，于是转变了原来的按钮设计策略，决定将文字显示到旁边。

- 采用极简主义的设计哲学，力求让使用者快速上手，功能简单明了，而不采用学长们的图形化图标设计方法。


## 盘卓实 
- 上午：修改了action_maneger,以实现分支。
- 下午：研究了在工作区文件丢失的情况下，如何恢复。以及虚拟机非正常关闭后，如何重启。鉴于这两个问题虽然不常见，但是一旦发生，就无法继续开发，影响很大，所以总结如下。

### 工作区丢失后如何恢复
- 删除工作区，主要是删除build文件夹。
- 找到别人能编译的catkin_ws
- 按照实验文档中的方法，新建工作区。sudo apt-get的方式下载的包不用重下
- 复制别人的catkin_ws下的src文件夹，到自己的catkin_ws下
- 编译，这时一般不会通过
- 如果不通过，可以根据报错，找到对应的.cpp文件，然后去cmakelist里面注释掉和这些cpp相关的编译命令
- 删除之前的build文件夹，即可编译


### 虚拟机非正常关闭后，重启失败
- 虚拟机重启失败是因为有一个对磁盘枷锁的机制，防止多开虚拟机。
- 所以只要去虚拟机磁盘所在的目录，删除所有.lck文件，即可重启。


## 魏子卜

- 跑wpb_home_apps里的who_is_who.cpp，出现连接摄像头的问题，无法launch
- 做一些wph_home_apps中的其他功能
- 加入的其他传感器：

### 红外温度传感器MLX90614
- GY-906使用Arduino编程，测量人的体温（也可以测量环境温度）
- 相关资料
- https://download.csdn.net/download/qq_43607011/10914278
- https://blog.csdn.net/lsjackson13/article/details/90256571
- https://blog.csdn.net/weixin_33893473/article/details/94341423?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162522781316780269889902%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=162522781316780269889902&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-94341423.first_rank_v2_pc_rank_v29&utm_term=MLX90614+arduino&spm=1018.2226.3001.4187

### 温湿度传感器DHT11/DHT22/LM35
- 测量环境温度和湿度
- 相关资料
- https://blog.csdn.net/k1ang/article/details/98789397
- https://blog.csdn.net/k1ang/article/details/107117077?spm=1001.2014.3001.5501

### FM收音机模块RDA5807 
在娱乐模式下可以当一个收音机
- 相关资料
- https://blog.csdn.net/zhuoqingjoking97298/article/details/104116006
- 

### 压电薄膜传感器SDT1-028K / 压电传感器SC0073
- 测心率
- 从西主楼捡了一个压电传感器
- 会涉及到一些模电的知识，如放大滤波等
- 相关资料
- 梁妮,陈妮,张琥石,黄代政.脉搏信号采集传输实验系统设计[J].实验技术与管理,2018,35(08):97-100+104.

## 李晨韬
- 今天从早晨到下午基本都在和盘哥看actionmanager的底层，因为如果要用写脚本的方式来获得语音控制的信息是不太现实的，因为脚本中是将动作全都划入一个队列中，必须执行完毕一个指令后才能执行另一个指令，无法做到随便说方向，它都能完成控制。起初打算修改actionmanager的底层，期望用上一次检测到的语音结果来决定下一个执行动作，但这包含了非常多和细碎的修改，很有可能牵一发而动全身，编译时都很难通过，我们决定放弃这种较为复杂的脚本编写方法。之后我决定尝试结合sr_node和vel_ctl两个实例来综合编写一个cpp及其对应的launch文件。
- 我是编写成功了一个节点文件voicectrl_node.cpp ， 尝试利用rosrun来跑节点程序，但结果很糟糕，感觉像是什么进程被阻塞了，编译一切正常，在终端运行时不出结果。
- 对wpb_home_apps中其他文件进行细致的阅读，我认为接下来机械臂的动作完成可以由脚本来编写
- 还是经典网卡问题，我发现语音识别无法开启，必须切换至Wi-Fi网络，在这来回切换之中，我的网卡不出意外的出了意外，始终连不上网，无法测试与语音输出有关的内容，后来晚上拿至科技服务队，并没有解决，但是在反复重启后，它神奇地好了，让我大受震撼。
- 今天最大的收获还是语音识别部分吧，如果明天能做出相应的结果，我觉得就可以把我之前做的相机部分和语音部分结合在一起使用了。

# 2021.7.3
## 何东阳

- 改变了菜单栏样式
 <div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202107034.PNG?raw=true;"style="zoom:67%;" /></div>

- 改变设置样式表的过程中，颜色十六进制数未大写，一开始显示失败，经查阅后改变

- 改变了设toggle按钮大小并添加了点击toggle按钮就显示进度条功能：
<div align=center><img src="https://github.com/hdy2001/2021thu10/blob/main/%E5%BC%80%E5%8F%91%E6%97%A5%E5%BF%97/image/202107035.PNG?raw=true;"style="zoom:67%;" /></div>

- 在模式选择窗口添加了两个新模式进入按钮

- 完善了界面逻辑，在位置设置界面中，进入设置状态后不可点击其他按钮，点击退出按钮后方可点击。

- 初步研究机械臂文档

## 李晨韬
- 尝试完成语音控制运动模块，能够识别多种语音，但是发现某一运动线程一旦开始（比如说“前进”），之后再使用其他语音指令控制（如“左边”），会发现进程被堵塞，第一个线程在始终运行。
- 为此我尝试利用多线程进行操作，主要使用pthread_create（）函数完成四个参数的传输。最后成功解决这一问题。语音控制运动模块基本设计完成。


# 2021.7.4
## 魏子卜
- 红外测温arduino资料
- https://blog.csdn.net/weixin_39541750/article/details/113025892



# 2021.7.5
## 魏子卜
### 读取温度
- 在移植到lct电脑上时发现哪些操作是有用的
- arduino部分
- arduino要在命令行里运行 sudo arduino
- 这时打开的arduino IDE再装adafruit，改mega，port再改成ttyUSB0
- 还会出现串口连不上的情况
- 改preferences.txt的port
- blog.csdn.net/cnsword/article/details/7964574
- 
- python部分
- [Errno 13] Permission denied: '/dev/ttyUSB0'
- https://blog.csdn.net/w383117613/article/details/44216653
- IOError: File not open for writing
- 没有写的权限 在txt所在文件夹下open terminal 给指令sudo chmod 777 TempData.txt
- 发现是open里忘了写'w'了
- 
- cpp部分
- 改个地址就完事了
